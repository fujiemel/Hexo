<article class="sea-page-card-wrapper">
  <header class="sea-article-header">
    <h1 class="sea-article-title">{{ page.title }}</h1>
    {% if is_post() %}
      <div class="sea-post-meta sea-post-meta__center">
        {{ partial('_partial/post/post_date', {post_date: page.date}) }}
        {{ partial('_partial/post/post_categories', {post_categories: page.categories}) }}
        {{ partial('_partial/post/post_tags', {post_tags: page.tags}) }}
      </div>
    {% endif %}
  </header>
  <div class="sea-doc">
    {% if page.tableOfContents %}
      {% set tocContent = toc(page.content) %}
      {% if tocContent %}
        <div class="sea-article-catalog">
          <h2 class="sea-article-catalog-title">
            {{ partial('svg/arrow_right_fill') }}
            {{ __('page.contents') }}
          </h2>
          {{ tocContent }}
        </div>
      {% endif %}
    {% endif %}
    <div class="sea-article-content">
      {% if page.encrypted %}
        <div class="sea-encrypt-container">
          <div class="sea-encrypt-box">
            <div class="sea-encrypt-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48"><path fill="currentColor" d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v2z"/></svg>
            </div>
            <p class="sea-encrypt-desc">这篇文章已加密，请输入密码查看内容</p>
            <div class="sea-encrypt-input-group">
              <input type="password" id="post-password" placeholder="请输入访问密码..." />
              <button id="verify-password">验证密码</button>
            </div>
            <p id="encrypt-error" class="sea-encrypt-error" style="display: none;">密码错误，请重新输入</p>
          </div>
        </div>
        <div id="encrypted-content" style="display: none;">
          {{ render(page.content) }}
        </div>
        <script>
          (function() {
            const pwdInput = document.getElementById('post-password');
            const verifyBtn = document.getElementById('verify-password');
            const errorMsg = document.getElementById('encrypt-error');
            const content = document.getElementById('encrypted-content');
            const container = document.querySelector('.sea-encrypt-container');
            const correctPassword = '{{ page.password }}';

            function check() {
              if (pwdInput.value === correctPassword) {
                container.style.display = 'none';
                content.style.display = 'block';
                // 触发某些可能需要内容可见后初始化的脚本
                window.dispatchEvent(new Event('resize'));
              } else {
                errorMsg.style.display = 'block';
                pwdInput.value = '';
                pwdInput.focus();
              }
            }

            verifyBtn.addEventListener('click', check);
            pwdInput.addEventListener('keypress', (e) => {
              if (e.key === 'Enter') check();
            });
          })();
        </script>
      {% else %}
        {{ render(page.content) }}
      {% endif %}
    </div>
  </div>

  {% if is_post() %}
    {{ partial('_partial/main/prev_next') }}
  {% endif %}
</article>

{{ partial('_plugins/comments/index') }}

<script defer>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleIcon = document.querySelector('.sea-article-catalog-title .sea-svg-icon');
    const tocContent = document.querySelector('.sea-article-catalog > .toc');
    if (toggleIcon && tocContent) {
      toggleIcon.addEventListener('click', function () {
        tocContent.classList.toggle('sea-article-catalog-show');
        toggleIcon.classList.toggle('sea-svg-icon-rotate');
      });
    }
  });
</script>